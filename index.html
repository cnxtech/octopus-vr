<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello, World! - A-Frame</title>
    <meta name="description" content="Hello, World! - A-Frame">
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.5.0/annyang.min.js"></script> 
    <script src="https://unpkg.com/aframe-text-geometry-component@^0.5.0/dist/aframe-text-geometry-component.min.js"></script>
    <script src="https://rawgit.com/ngokevin/aframe-look-at-component/master/dist/aframe-look-at-component.min.js"></script>
    <!-- <script src="./../assets/xfinity_sans_light_regular.js"></script> -->
  </head>
  <body>
    <script>
      AFRAME.registerComponent('text-box', {
        init: function() {
          console.log('in init text-box');
        },

        toggle: function() {
          const el = this.el;
          console.log('hide');
          el.setAttribute('visible', !el.getAttribute('visible'));
        }
      });
      AFRAME.registerComponent('speech-recognition', {
        init: function () {
          //console.log("in annyang-speech-recognition init");
          this.play()
        },
        showPerson: function(name) {
          console.log(`show name ${name}`)
        },
        showCurrentSpeaker: function() {
          console.log('show current speaker')
          const descriptionText = document.querySelector('#descriptionText');
          descriptionText.setAttribute('value', 'Some lady is talking')
        },
        play: function() {
          if (!annyang) { return }

          let commands = {
            'who is talking': this.showCurrentSpeaker,
            'who is speaking': this.showCurrentSpeaker,
            'who is *name': this.showPerson
          }

          annyang.debug()
          annyang.addCommands(commands)
          annyang.setLanguage('en')


          // var speechCommandSystem = document.querySelector('a-scene').systems['speech-command'];
          // var commands = {};
          // var commandsMap = {};
          // for (var i = 0; i < speechCommandSystem.entities.length; i++) {
          //     var speechCommand = speechCommandSystem.entities[i];
          //     commandsMap[speechCommand.data.command] = speechCommand;
          //     // note: function empty here because real work is done in the resultMatch callback below
          //     commands[speechCommand.data.command] = function() { };
          // }
          // annyang.addCommands(commands);

          // annyang.addCallback('resultMatch', function(userSaid, commandText, phrases) {
          //     //console.log("commandText: "+commandText); // sample output: 'hello (there)'
          //     var speechCommand = commandsMap[commandText];
          //     speechCommand.executeCommand();
          // });
          // Start listening. You can call this here, or attach this call to an event, button, etc.
          console.log('annyang starting')
          annyang.start();
        }
      });
    </script>
    <a-scene>
      <a-videosphere src="#video" rotation="0 180 0"></a-videosphere>
      <a-entity id="annyang" speech-recognition></a-entity>
      <a-assets>
        <a-asset-item id="xfinitySansLightRegular" 
                      src="/assets/xfinity_sans_light_regular.json">
        </a-asset-item>
        <a-mixin id="xfinitySansLightRegular" text="font: #xfinitySansLightRegular"></a-mixin>
        <video id="rhonyc" 
               preload="auto" 
               src="./../assets/rhonyc_801.mp4#t=50"
               autoplay loop crossorigin="anonymous" position="2 2 2">
        </video>
      </a-assets>
      <a-entity id="video"
                material="shader: flat; src: #rhonyc"
                geometry="primitive: plane; width: 360; height: 240;"
                position="0 0 -250"
                rotation="0 0 0">
      </a-entity>
      <a-camera camera>
        <a-text id="descriptionText"
                value="Sample text"
                font="/assets/Roboto-msdf.json"
                fontImage="/assets/Roboto-msdf.png"
                height="20"
                position="4.8 3.5 -5"
                color="black"
                width="2.5"
                >
        </a-text>
        <a-box text-box
             id="textBox"
             material="color: #555555; transparent: true; opacity: 0.5" 
             depth="0.01" height="100" width="3" 
             position="6 2 -5">
        </a-box>
      </a-camera>
    </a-scene>
  </body>
</html>
